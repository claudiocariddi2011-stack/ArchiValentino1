<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Messaggi Anonimi</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f4f4; padding:20px; }
h1, h2 { color:#333; }
.box { background:#fff; padding:15px; margin-bottom:20px; border-radius:8px; }
input, textarea, button { width:100%; padding:8px; margin-top:8px; }
ul { list-style:none; padding:0; }
li { padding:6px; background:#eee; margin-top:5px; cursor:pointer; border-radius:4px; }
li:hover { background:#ddd; }
</style>


<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
<h1>ðŸ“© Messaggi Anonimi</h1>


<div class="box">
<h2>Registrazione</h2>
<input id="nome" placeholder="Nome" />
<input id="cognome" placeholder="Cognome" />
<button onclick="registra()">Registrati</button>
</div>


<div class="box">
<h2>Persone registrate</h2>
<ul id="lista"></ul>
</div>


<div class="box" id="messaggiBox" style="display:none;">
<h2 id="destinatario"></h2>
<textarea id="messaggio" placeholder="Scrivi un messaggio anonimo..."></textarea>
<button onclick="inviaMessaggio()">Invia messaggio</button>
</div>


<div class="box" id="leggiBox" style="display:none;">
<h2>Messaggi ricevuti</h2>
<ul id="messaggiRicevuti"></ul>
</div>


<div class="box">
<button onclick="leggiMessaggi()">Vedi i miei messaggi</button>
</div>


<script>
const firebaseConfig = {
apiKey: "AIzaSyDCguHTXRwtx0mdDRLC_kZeKElEJeErxV8",
authDomain: "archivalentino-2de41.firebaseapp.com",
projectId: "archivalentino-2de41",
storageBucket: "archivalentino-2de41.appspot.com",
messagingSenderId: "641724408583",
appId: "1:641724408583:web:cdfaff6456628862a65ba2",
measurementId: "G-8FNZX5ZM73"
};


firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();


let selezionato = null;
let userId = localStorage.getItem('userId') || null;


function registra() {
const nome = document.getElementById('nome').value.trim();
const cognome = document.getElementById('cognome').value.trim();
if (!nome || !cognome) return alert('Inserisci nome e cognome');


db.collection('utenti').add({
nome,
cognome,
created: firebase.firestore.FieldValue.serverTimestamp()
}).then(docRef => {
alert('Registrazione completata âœ…');
userId = docRef.id;
localStorage.setItem('userId', userId);
caricaUtenti();
document.getElementById('nome').value='';
document.getElementById('cognome').value='';
leggiMessaggi();
}).catch(err => console.error(err));
}


function caricaUtenti() {
db.collection('utenti').orderBy('created').get().then(snapshot => {
const ul = document.getElementById('lista');
</html>
